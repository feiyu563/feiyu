
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python之路【第十七篇】：Django【进阶篇 】 - 武沛齐 - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=m_FXmwz3wxZoecUwNEK23PAzc-j9vbX_C6MblJ5ouMc1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue.css?v=jJERBFSojhmgst84aaRDal9S3q1WoO-WcNudmMzGJS81"/>
<link type="text/css" rel="stylesheet" href="/blog/customcss/133379.css?v=YSNZANkz7eBKoXq2iHYfghvodkY%3d"/>
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue-mobile.css?v=z0BacpCfWeLlXDCM0C158kTP_DMqMbGBapID4f-QztI1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/wupeiqi/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/wupeiqi/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/wupeiqi/wlwmanifest.xml"/>
<script src="//common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'wupeiqi', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="/bundles/blog-common.js?v=CPv0EEqm9L2aCgolHxaZfVYM6J-Sn5az_FJXbjzgr-o1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/wupeiqi/">Mr.Seven</a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/wupeiqi/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/%E6%AD%A6%E6%B2%9B%E9%BD%90">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/wupeiqi/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/wupeiqi/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-126&nbsp;
文章-137&nbsp;
评论-259&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/wupeiqi/articles/5246483.html">Python之路【第十七篇】：Django【进阶篇 】</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><h3>Model</h3>
<p>到目前为止，当我们的程序涉及到数据库相关操作时，我们一般都会这么搞：</p>
<ul>
<li>创建数据库，设计表结构和字段</li>
<li>使用 MySQLdb 来连接数据库，并编写数据访问层代码</li>
<li>业务逻辑层去调用数据访问层执行数据库操作</li>
</ul>
<div class="cnblogs_code" onclick="cnblogs_code_show('63089d74-4317-4df6-86b1-8f8ef8754fd6')"><img id="code_img_closed_63089d74-4317-4df6-86b1-8f8ef8754fd6" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_63089d74-4317-4df6-86b1-8f8ef8754fd6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('63089d74-4317-4df6-86b1-8f8ef8754fd6',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_63089d74-4317-4df6-86b1-8f8ef8754fd6" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> MySQLdb
 
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> GetList(sql):
    db </span>= MySQLdb.connect(user=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span>, db=<span style="color: #800000;">'</span><span style="color: #800000;">wupeiqidb</span><span style="color: #800000;">'</span>, passwd=<span style="color: #800000;">'</span><span style="color: #800000;">1234</span><span style="color: #800000;">'</span>, host=<span style="color: #800000;">'</span><span style="color: #800000;">localhost</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    cursor </span>=<span style="color: #000000;"> db.cursor()
    cursor.execute(sql)
    data </span>=<span style="color: #000000;"> cursor.fetchall()
    db.close()
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> data
 
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> GetSingle(sql):
    db </span>= MySQLdb.connect(user=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span>, db=<span style="color: #800000;">'</span><span style="color: #800000;">wupeiqidb</span><span style="color: #800000;">'</span>, passwd=<span style="color: #800000;">'</span><span style="color: #800000;">1234</span><span style="color: #800000;">'</span>, host=<span style="color: #800000;">'</span><span style="color: #800000;">localhost</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    cursor </span>=<span style="color: #000000;"> db.cursor()
    cursor.execute(sql)
    data </span>=<span style="color: #000000;"> cursor.fetchone()
    db.close()
    </span><span style="color: #0000ff;">return</span> data</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>django为使用一种新的方式，即：关系对象映射（Object Relational Mapping，简称ORM）。</p>
<p>　　PHP：activerecord</p>
<p>　　Java：Hibernate&nbsp;</p>
<p>&nbsp; 　　C#：Entity&nbsp;Framework</p>
<p>django中遵循 Code Frist 的原则，即：根据代码中定义的类来自动生成数据库表。</p>
<p>一、创建表</p>
<p>1、基本结构</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from django.db import models
  
class userinfo(models.Model):
    name = models.CharField(max_length=30)
    email = models.EmailField()
    memo = models.TextField()</pre>
</div>
<div class="cnblogs_code" onclick="cnblogs_code_show('d51409a6-cef1-4374-8740-7181819fcf34')"><img id="code_img_closed_d51409a6-cef1-4374-8740-7181819fcf34" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_d51409a6-cef1-4374-8740-7181819fcf34" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d51409a6-cef1-4374-8740-7181819fcf34',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_d51409a6-cef1-4374-8740-7181819fcf34" class="cnblogs_code_hide">
<pre><span style="color: #000000;">    AutoField(Field)
        </span>- int自增列，必须填入参数 primary_key=<span style="color: #000000;">True

    BigAutoField(AutoField)
        </span>- bigint自增列，必须填入参数 primary_key=<span style="color: #000000;">True

        注：当model中如果没有自增列，则自动会创建一个列名为id的列
        </span><span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 自动创建一个列名为id的且为自增的整数列</span>
            username = models.CharField(max_length=32<span style="color: #000000;">)

        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Group(models.Model):
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 自定义自增列</span>
            nid = models.AutoField(primary_key=<span style="color: #000000;">True)
            name </span>= models.CharField(max_length=32<span style="color: #000000;">)

    SmallIntegerField(IntegerField):
        </span>- 小整数 -32768 ～ 32767<span style="color: #000000;">

    PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)
        </span>- 正小整数 0 ～ 32767<span style="color: #000000;">
    IntegerField(Field)
        </span>- 整数列(有符号的) -2147483648 ～ 2147483647<span style="color: #000000;">

    PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)
        </span>- 正整数 0 ～ 2147483647<span style="color: #000000;">

    BigIntegerField(IntegerField):
        </span>- 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807<span style="color: #000000;">

    自定义无符号整数字段

        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UnsignedIntegerField(models.IntegerField):
            </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> db_type(self, connection):
                </span><span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">integer UNSIGNED</span><span style="color: #800000;">'</span><span style="color: #000000;">

        PS: 返回值为字段在数据库中的属性，Django字段默认的值为：
            </span><span style="color: #800000;">'</span><span style="color: #800000;">AutoField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">integer AUTO_INCREMENT</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BigAutoField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bigint AUTO_INCREMENT</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BinaryField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">longblob</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BooleanField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bool</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">CharField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">varchar(%(max_length)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">CommaSeparatedIntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">varchar(%(max_length)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">DateField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">date</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">DateTimeField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">datetime</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">DecimalField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">numeric(%(max_digits)s, %(decimal_places)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">DurationField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bigint</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">FileField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">varchar(%(max_length)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">FilePathField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">varchar(%(max_length)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">FloatField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">double precision</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">IntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">integer</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BigIntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bigint</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">IPAddressField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">char(15)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">GenericIPAddressField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">char(39)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">NullBooleanField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bool</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">OneToOneField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">integer</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">PositiveIntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">integer UNSIGNED</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">PositiveSmallIntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">smallint UNSIGNED</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">SlugField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">varchar(%(max_length)s)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">SmallIntegerField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">smallint</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">TextField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">longtext</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">TimeField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">time</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">UUIDField</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">char(32)</span><span style="color: #800000;">'</span><span style="color: #000000;">,

    BooleanField(Field)
        </span>-<span style="color: #000000;"> 布尔值类型

    NullBooleanField(Field):
        </span>-<span style="color: #000000;"> 可以为空的布尔值

    CharField(Field)
        </span>-<span style="color: #000000;"> 字符类型
        </span>-<span style="color: #000000;"> 必须提供max_length参数， max_length表示字符长度

    TextField(Field)
        </span>-<span style="color: #000000;"> 文本类型

    EmailField(CharField)：
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供验证机制

    IPAddressField(Field)
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制

    GenericIPAddressField(Field)
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6
        </span>-<span style="color: #000000;"> 参数：
            protocol，用于指定Ipv4或Ipv6， </span><span style="color: #800000;">'</span><span style="color: #800000;">both</span><span style="color: #800000;">'</span>,<span style="color: #800000;">"</span><span style="color: #800000;">ipv4</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">ipv6</span><span style="color: #800000;">"</span><span style="color: #000000;">
            unpack_ipv4， 如果指定为True，则输入::ffff:</span>192.0.2.1时候，可解析为192.0.2.1，开启刺功能，需要protocol=<span style="color: #800000;">"</span><span style="color: #800000;">both</span><span style="color: #800000;">"</span><span style="color: #000000;">

    URLField(CharField)
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供验证 URL

    SlugField(CharField)
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）

    CommaSeparatedIntegerField(CharField)
        </span>-<span style="color: #000000;"> 字符串类型，格式必须为逗号分割的数字

    UUIDField(Field)
        </span>-<span style="color: #000000;"> 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证

    FilePathField(Field)
        </span>-<span style="color: #000000;"> 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能
        </span>-<span style="color: #000000;"> 参数：
                path,                      文件夹路径
                match</span>=<span style="color: #000000;">None,                正则匹配
                recursive</span>=<span style="color: #000000;">False,           递归下面的文件夹
                allow_files</span>=<span style="color: #000000;">True,          允许文件
                allow_folders</span>=<span style="color: #000000;">False,       允许文件夹

    FileField(Field)
        </span>-<span style="color: #000000;"> 字符串，路径保存在数据库，文件上传到指定目录
        </span>-<span style="color: #000000;"> 参数：
            upload_to </span>= <span style="color: #800000;">""</span><span style="color: #000000;">      上传文件的保存路径
            storage </span>=<span style="color: #000000;"> None      存储组件，默认django.core.files.storage.FileSystemStorage

    ImageField(FileField)
        </span>-<span style="color: #000000;"> 字符串，路径保存在数据库，文件上传到指定目录
        </span>-<span style="color: #000000;"> 参数：
            upload_to </span>= <span style="color: #800000;">""</span><span style="color: #000000;">      上传文件的保存路径
            storage </span>=<span style="color: #000000;"> None      存储组件，默认django.core.files.storage.FileSystemStorage
            width_field</span>=<span style="color: #000000;">None,   上传图片的高度保存的数据库字段名（字符串）
            height_field</span>=<span style="color: #000000;">None   上传图片的宽度保存的数据库字段名（字符串）

    DateTimeField(DateField)
        </span>- 日期+时间格式 YYYY-MM-<span style="color: #000000;">DD HH:MM[:ss[.uuuuuu]][TZ]

    DateField(DateTimeCheckMixin, Field)
        </span>- 日期格式      YYYY-MM-<span style="color: #000000;">DD

    TimeField(DateTimeCheckMixin, Field)
        </span>-<span style="color: #000000;"> 时间格式      HH:MM[:ss[.uuuuuu]]

    DurationField(Field)
        </span>-<span style="color: #000000;"> 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型

    FloatField(Field)
        </span>-<span style="color: #000000;"> 浮点型

    DecimalField(Field)
        </span>-<span style="color: #000000;"> 10进制小数
        </span>-<span style="color: #000000;"> 参数：
            max_digits，小数总长度
            decimal_places，小数位长度

    BinaryField(Field)
        </span>- 二进制类型</pre>
</div>
<span class="cnblogs_code_collapse">字段</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c6e06067-683b-47d9-929a-f049acc6669d')"><img id="code_img_closed_c6e06067-683b-47d9-929a-f049acc6669d" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_c6e06067-683b-47d9-929a-f049acc6669d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c6e06067-683b-47d9-929a-f049acc6669d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_c6e06067-683b-47d9-929a-f049acc6669d" class="cnblogs_code_hide">
<pre><span style="color: #000000;">    null                数据库中字段是否可以为空
    db_column           数据库中字段的列名
    db_tablespace
    default             数据库中字段的默认值
    primary_key         数据库中字段是否为主键
    db_index            数据库中字段是否可以建立索引
    unique              数据库中字段是否可以建立唯一索引
    unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引
    unique_for_month    数据库中字段【月】部分是否可以建立唯一索引
    unique_for_year     数据库中字段【年】部分是否可以建立唯一索引

    verbose_name        Admin中显示的字段名称
    blank               Admin中是否允许用户输入为空
    editable            Admin中是否可以编辑
    help_text           Admin中该字段的提示信息
    choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作
                        如：gf </span>= models.IntegerField(choices=[(0, <span style="color: #800000;">'</span><span style="color: #800000;">何穗</span><span style="color: #800000;">'</span>),(1, <span style="color: #800000;">'</span><span style="color: #800000;">大表姐</span><span style="color: #800000;">'</span>),],default=1<span style="color: #000000;">)

    error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；
                        字典健：null, blank, invalid, invalid_choice, unique, </span><span style="color: #0000ff;">and</span><span style="color: #000000;"> unique_for_date
                        如：{</span><span style="color: #800000;">'</span><span style="color: #800000;">null</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">不能为空.</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">}

    validators          自定义错误验证（列表类型），从而定制想要的验证规则
                        </span><span style="color: #0000ff;">from</span> django.core.validators <span style="color: #0000ff;">import</span><span style="color: #000000;"> RegexValidator
                        </span><span style="color: #0000ff;">from</span> django.core.validators <span style="color: #0000ff;">import</span><span style="color: #000000;"> EmailValidator,URLValidator,DecimalValidator,\
                        MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator
                        如：
                            test </span>=<span style="color: #000000;"> models.CharField(
                                max_length</span>=32<span style="color: #000000;">,
                                error_messages</span>=<span style="color: #000000;">{
                                    </span><span style="color: #800000;">'</span><span style="color: #800000;">c1</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">优先错信息1</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                    </span><span style="color: #800000;">'</span><span style="color: #800000;">c2</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">优先错信息2</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                    </span><span style="color: #800000;">'</span><span style="color: #800000;">c3</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">优先错信息3</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                },
                                validators</span>=<span style="color: #000000;">[
                                    RegexValidator(regex</span>=<span style="color: #800000;">'</span><span style="color: #800000;">root_\d+</span><span style="color: #800000;">'</span>, message=<span style="color: #800000;">'</span><span style="color: #800000;">错误了</span><span style="color: #800000;">'</span>, code=<span style="color: #800000;">'</span><span style="color: #800000;">c1</span><span style="color: #800000;">'</span><span style="color: #000000;">),
                                    RegexValidator(regex</span>=<span style="color: #800000;">'</span><span style="color: #800000;">root_112233\d+</span><span style="color: #800000;">'</span>, message=<span style="color: #800000;">'</span><span style="color: #800000;">又错误了</span><span style="color: #800000;">'</span>, code=<span style="color: #800000;">'</span><span style="color: #800000;">c2</span><span style="color: #800000;">'</span><span style="color: #000000;">),
                                    EmailValidator(message</span>=<span style="color: #800000;">'</span><span style="color: #800000;">又错误了</span><span style="color: #800000;">'</span>, code=<span style="color: #800000;">'</span><span style="color: #800000;">c3</span><span style="color: #800000;">'</span><span style="color: #000000;">), ]
                            )</span></pre>
</div>
<span class="cnblogs_code_collapse">参数</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('e1c44e1e-bd5b-4d66-8eb6-9d09b24bdb28')"><img id="code_img_closed_e1c44e1e-bd5b-4d66-8eb6-9d09b24bdb28" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_e1c44e1e-bd5b-4d66-8eb6-9d09b24bdb28" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e1c44e1e-bd5b-4d66-8eb6-9d09b24bdb28',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_e1c44e1e-bd5b-4d66-8eb6-9d09b24bdb28" class="cnblogs_code_hide">
<pre>    <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
        nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
        username </span>= models.CharField(max_length=32<span style="color: #000000;">)
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span>
            db_table = <span style="color: #800000;">"</span><span style="color: #800000;">table_name</span><span style="color: #800000;">"</span>

            <span style="color: #008000;">#</span><span style="color: #008000;"> 联合索引</span>
            index_together =<span style="color: #000000;"> [
                (</span><span style="color: #800000;">"</span><span style="color: #800000;">pub_date</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">deadline</span><span style="color: #800000;">"</span><span style="color: #000000;">),
            ]

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 联合唯一索引</span>
            unique_together = ((<span style="color: #800000;">"</span><span style="color: #800000;">driver</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">restaurant</span><span style="color: #800000;">"</span><span style="color: #000000;">),)

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> admin中显示的表名称</span>
<span style="color: #000000;">            verbose_name

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> verbose_name加s</span>
<span style="color: #000000;">            verbose_name_plural
        
    更多：https:</span>//docs.djangoproject.com/en/1.10/ref/models/options/</pre>
</div>
<span class="cnblogs_code_collapse">元信息</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('24761c59-6831-41e1-9716-8ca773ccaaf0')"><img id="code_img_closed_24761c59-6831-41e1-9716-8ca773ccaaf0" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_24761c59-6831-41e1-9716-8ca773ccaaf0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('24761c59-6831-41e1-9716-8ca773ccaaf0',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_24761c59-6831-41e1-9716-8ca773ccaaf0" class="cnblogs_code_hide">
<pre>    1<span style="color: #000000;">.触发Model中的验证和错误提示有两种方式：
        a. Django Admin中的错误信息会优先根据Admiin内部的ModelForm错误信息提示，如果都成功，才来检查Model的字段并显示指定错误信息
        b. 调用Model对象的 clean_fields 方法，如：
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> models.py</span>
            <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
                nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
                username </span>= models.CharField(max_length=32<span style="color: #000000;">)

                email </span>= models.EmailField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">格式错了.</span><span style="color: #800000;">'</span><span style="color: #000000;">})

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> views.py</span>
            <span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
                obj </span>= models.UserInfo(username=<span style="color: #800000;">'</span><span style="color: #800000;">11234</span><span style="color: #800000;">'</span>, email=<span style="color: #800000;">'</span><span style="color: #800000;">uu</span><span style="color: #800000;">'</span><span style="color: #000000;">)
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;">:
                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(obj.clean_fields())
                </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(e)
                </span><span style="color: #0000ff;">return</span> HttpResponse(<span style="color: #800000;">'</span><span style="color: #800000;">ok</span><span style="color: #800000;">'</span><span style="color: #000000;">)

           </span><span style="color: #008000;">#</span><span style="color: #008000;"> Model的clean方法是一个钩子，可用于定制操作，如：上述的异常处理。</span>

    2<span style="color: #000000;">.Admin中修改错误提示
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> admin.py</span>
        <span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
        </span><span style="color: #0000ff;">from</span> model_club <span style="color: #0000ff;">import</span><span style="color: #000000;"> models
        </span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms


        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoForm(forms.ModelForm):
            username </span>= forms.CharField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">用户名不能为空.</span><span style="color: #800000;">'</span><span style="color: #000000;">})
            email </span>= forms.EmailField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误.</span><span style="color: #800000;">'</span><span style="color: #000000;">})
            age </span>= forms.IntegerField(initial=1, error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">请输入数值.</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">年龄必须为数值.</span><span style="color: #800000;">'</span><span style="color: #000000;">})

            </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
                model </span>=<span style="color: #000000;"> models.UserInfo
                </span><span style="color: #008000;">#</span><span style="color: #008000;"> fields = ('username',)</span>
                fields = <span style="color: #800000;">"</span><span style="color: #800000;">__all__</span><span style="color: #800000;">"</span>


        <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoAdmin(admin.ModelAdmin):
            form </span>=<span style="color: #000000;"> UserInfoForm


        admin.site.register(models.UserInfo, UserInfoAdmin)</span></pre>
</div>
<span class="cnblogs_code_collapse">拓展知识</span></div>
<p>2、连表结构</p>
<ul>
<li>一对多：models.ForeignKey(其他表)</li>
<li>多对多：models.ManyToManyField(其他表)</li>
<li>一对一：models.OneToOneField(其他表)</li>
</ul>
<blockquote>
<p>应用场景：</p>
<ul>
<li>一对多：当一张表中创建一行数据时，有一个单选的下拉框（可以被重复选择）<br /><em>例如：创建用户信息时候，需要选择一个用户类型【普通用户】【金牌用户】【铂金用户】等。</em></li>
<li>多对多：在某表中创建一行数据是，有一个可以多选的下拉框<br /><em>例如：创建用户信息，需要为用户指定多个爱好</em></li>
<li>一对一：在某表中创建一行数据时，有一个单选的下拉框（下拉框中的内容被用过一次就消失了<br /><em>例如：原有含<em>10列数据的</em>一张表保存相关信息，经过一段时间之后，10列无法满足需求，需要为原来的表再添加5列数据</em></li>




















</ul>




















</blockquote>
<div class="cnblogs_code" onclick="cnblogs_code_show('2bdf0648-0a7d-489b-aed0-ef58bf5682a9')"><img id="code_img_closed_2bdf0648-0a7d-489b-aed0-ef58bf5682a9" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_2bdf0648-0a7d-489b-aed0-ef58bf5682a9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2bdf0648-0a7d-489b-aed0-ef58bf5682a9',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_2bdf0648-0a7d-489b-aed0-ef58bf5682a9" class="cnblogs_code_hide">
<pre>    ForeignKey(ForeignObject) <span style="color: #008000;">#</span><span style="color: #008000;"> ForeignObject(RelatedField)</span>
        to,                         <span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
        to_field=None,              <span style="color: #008000;">#</span><span style="color: #008000;"> 要关联的表中的字段名称</span>
        on_delete=None,             <span style="color: #008000;">#</span><span style="color: #008000;"> 当删除关联表中的数据时，当前表与其关联的行的行为</span>
                                        -<span style="color: #000000;"> models.CASCADE，删除关联数据，与之关联也删除
                                        </span>-<span style="color: #000000;"> models.DO_NOTHING，删除关联数据，引发错误IntegrityError
                                        </span>-<span style="color: #000000;"> models.PROTECT，删除关联数据，引发错误ProtectedError
                                        </span>-<span style="color: #000000;"> models.SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）
                                        </span>-<span style="color: #000000;"> models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）
                                        </span>-<span style="color: #000000;"> models.SET，删除关联数据，
                                                      a. 与之关联的值设置为指定值，设置：models.SET(值)
                                                      b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)

                                                        </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
                                                            </span><span style="color: #0000ff;">return</span> 10

                                                        <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyModel(models.Model):
                                                            user </span>=<span style="color: #000000;"> models.ForeignKey(
                                                                to</span>=<span style="color: #800000;">"</span><span style="color: #800000;">User</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                                to_field</span>=<span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span><span style="color: #000000;">
                                                                on_delete</span>=<span style="color: #000000;">models.SET(func),)
        related_name</span>=None,          <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
        related_query_name=None,    <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
        limit_choices_to=None,      <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin或ModelForm中显示关联数据时，提供的条件：</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 如：</span>
                                            - limit_choices_to={<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}
                                            </span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : {<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}

                                            </span><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Q
                                            </span>- limit_choices_to=Q(nid__gt=10<span style="color: #000000;">)
                                            </span>- limit_choices_to=Q(nid=8) | Q(nid__gt=10<span style="color: #000000;">)
                                            </span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        db_constraint</span>=True          <span style="color: #008000;">#</span><span style="color: #008000;"> 是否在数据库中创建外键约束</span>
        parent_link=False           <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin中是否显示关联数据</span>
<span style="color: #000000;">

    OneToOneField(ForeignKey)
        to,                         </span><span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
        to_field=None               <span style="color: #008000;">#</span><span style="color: #008000;"> 要关联的表中的字段名称</span>
        on_delete=None,             <span style="color: #008000;">#</span><span style="color: #008000;"> 当删除关联表中的数据时，当前表与其关联的行的行为</span>

                                    <span style="color: #008000;">#</span><span style="color: #008000;">##### 对于一对一 ######</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 1. 一对一其实就是 一对多 + 唯一索引</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 如下会在A表中额外增加一个c_ptr_id列且唯一：</span>
                                            <span style="color: #0000ff;">class</span><span style="color: #000000;"> C(models.Model):
                                                nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
                                                part </span>= models.CharField(max_length=12<span style="color: #000000;">)

                                            </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> A(C):
                                                id </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
                                                code </span>= models.CharField(max_length=1<span style="color: #000000;">)

    ManyToManyField(RelatedField)
        to,                         </span><span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
        related_name=None,          <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
        related_query_name=None,    <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
        limit_choices_to=None,      <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin或ModelForm中显示关联数据时，提供的条件：</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 如：</span>
                                            - limit_choices_to={<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}
                                            </span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : {<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}

                                            </span><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Q
                                            </span>- limit_choices_to=Q(nid__gt=10<span style="color: #000000;">)
                                            </span>- limit_choices_to=Q(nid=8) | Q(nid__gt=10<span style="color: #000000;">)
                                            </span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        symmetrical</span>=None,           <span style="color: #008000;">#</span><span style="color: #008000;"> 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span>
                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 做如下操作时，不同的symmetrical会有不同的可选字段</span>
<span style="color: #000000;">                                        models.BB.objects.filter(...)

                                        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 可选字段有：code, id, m1</span>
                                            <span style="color: #0000ff;">class</span><span style="color: #000000;"> BB(models.Model):

                                            code </span>= models.CharField(max_length=12<span style="color: #000000;">)
                                            m1 </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">self</span><span style="color: #800000;">'</span>,symmetrical=<span style="color: #000000;">True)

                                        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 可选字段有: bb, code, id, m1</span>
                                            <span style="color: #0000ff;">class</span><span style="color: #000000;"> BB(models.Model):

                                            code </span>= models.CharField(max_length=12<span style="color: #000000;">)
                                            m1 </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">self</span><span style="color: #800000;">'</span>,symmetrical=<span style="color: #000000;">False)

        through</span>=None,               <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义第三张表时，使用字段用于指定关系表</span>
        through_fields=None,        <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span>
                                        <span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

                                        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Person(models.Model):
                                            name </span>= models.CharField(max_length=50<span style="color: #000000;">)

                                        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Group(models.Model):
                                            name </span>= models.CharField(max_length=128<span style="color: #000000;">)
                                            members </span>=<span style="color: #000000;"> models.ManyToManyField(
                                                Person,
                                                through</span>=<span style="color: #800000;">'</span><span style="color: #800000;">Membership</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                                through_fields</span>=(<span style="color: #800000;">'</span><span style="color: #800000;">group</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">person</span><span style="color: #800000;">'</span><span style="color: #000000;">),
                                            )

                                        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Membership(models.Model):
                                            group </span>= models.ForeignKey(Group, on_delete=<span style="color: #000000;">models.CASCADE)
                                            person </span>= models.ForeignKey(Person, on_delete=<span style="color: #000000;">models.CASCADE)
                                            inviter </span>=<span style="color: #000000;"> models.ForeignKey(
                                                Person,
                                                on_delete</span>=<span style="color: #000000;">models.CASCADE,
                                                related_name</span>=<span style="color: #800000;">"</span><span style="color: #800000;">membership_invites</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                            )
                                            invite_reason </span>= models.CharField(max_length=64<span style="color: #000000;">)
        db_constraint</span>=True,         <span style="color: #008000;">#</span><span style="color: #008000;"> 是否在数据库中创建外键约束</span>
        db_table=None,              <span style="color: #008000;">#</span><span style="color: #008000;"> 默认创建第三张表时，数据库中表的名称</span></pre>
</div>
<span class="cnblogs_code_collapse">字段以及参数</span></div>
<p>二、操作表</p>
<p>1、基本操作</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('a7e7bf93-36b3-4cfa-a3e2-35170c704901')"><img id="code_img_closed_a7e7bf93-36b3-4cfa-a3e2-35170c704901" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_a7e7bf93-36b3-4cfa-a3e2-35170c704901" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a7e7bf93-36b3-4cfa-a3e2-35170c704901',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_a7e7bf93-36b3-4cfa-a3e2-35170c704901" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 增</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.create(c1='xx', c2='oo')  增加一条数据，可以接受字典类型数据 **kwargs</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> obj = models.Tb1(c1='xx', c2='oo')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.save()</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 查</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.get(id=123)         # 获取单条数据，不存在则报错（不建议）</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.all()               # 获取全部</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven') # 获取指定条件的数据</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 删</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').delete() # 删除指定条件的数据</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 改</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').update(gender='0')  # 将指定条件的数据更新，均支持 **kwargs</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj = models.Tb1.objects.get(id=1)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.c1 = '111'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.save()                                                 # 修改单条数据</span></pre>
</div>
<span class="cnblogs_code_collapse">基本操作</span></div>
<p>2、进阶操作（了不起的双下划线）</p>
<p>利用双下划线将字段和对应的操作连接起来</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('0b10bbcf-d1ef-4c98-843c-d13caae2b403')"><img id="code_img_closed_0b10bbcf-d1ef-4c98-843c-d13caae2b403" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_0b10bbcf-d1ef-4c98-843c-d13caae2b403" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0b10bbcf-d1ef-4c98-843c-d13caae2b403',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_0b10bbcf-d1ef-4c98-843c-d13caae2b403" class="cnblogs_code_hide">
<pre>        <span style="color: #008000;">#</span><span style="color: #008000;"> 获取个数</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').count()</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> 大于，小于</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__gt=1)              # 获取id大于1的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__gte=1)              # 获取id大于等于1的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lt=10)             # 获取id小于10的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lte=10)             # 获取id小于10的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lt=10, id__gt=1)   # 获取id大于1 且 小于10的值</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> in</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__in=[11, 22, 33])   # 获取id等于11、22、33的数据</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.exclude(id__in=[11, 22, 33])  # not in</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> isnull</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__isnull=True)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> contains</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name__contains="ven")</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name__icontains="ven") # icontains大小写不敏感</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.exclude(name__icontains="ven")</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> range</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__range=[1, 2])   # 范围bettwen and</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> 其他类似</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> startswith，istartswith, endswith, iendswith,</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> order by</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').order_by('id')    # asc</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').order_by('-id')   # desc</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> group by</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db.models import Count, Min, Max, Sum</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(c1=1).values('id').annotate(c=Count('num'))</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> SELECT "app01_tb1"."id", COUNT("app01_tb1"."num") AS "c" FROM "app01_tb1" WHERE "app01_tb1"."c1" = 1 GROUP BY "app01_tb1"."id"</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> limit 、offset</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.all()[10:20]</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> regex正则匹配，iregex 不区分大小写</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.get(title__regex=r'^(An?|The) +')</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.get(title__iregex=r'^(an?|the) +')</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> date</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__date=datetime.date(2005, 1, 1))</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__date__gt=datetime.date(2005, 1, 1))</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> year</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__year=2005)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__year__gte=2005)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> month</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__month=12)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__month__gte=6)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> day</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__day=3)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__day__gte=3)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> week_day</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__week_day=2)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__week_day__gte=2)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> hour</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__hour=23)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__hour=5)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__hour__gte=12)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> minute</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__minute=29)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__minute=46)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__minute__gte=29)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> second</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__second=31)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__second=2)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__second__gte=31)</span></pre>
</div>
<span class="cnblogs_code_collapse">进阶操作</span></div>
<p>3、其他操作</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('474830a9-561c-4eef-a8f9-e353aadda605')"><img id="code_img_closed_474830a9-561c-4eef-a8f9-e353aadda605" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_474830a9-561c-4eef-a8f9-e353aadda605" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('474830a9-561c-4eef-a8f9-e353aadda605',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_474830a9-561c-4eef-a8f9-e353aadda605" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> extra</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> extra(self, select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(select={'new_id': "select col from sometable where othercol &gt; %s"}, select_params=(1,))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(where=['headline=%s'], params=['Lennon'])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(where=["foo='a' OR bar = 'a'", "baz = 'a'"])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(select={'new_id': "select id from tb where id &gt; %s"}, select_params=(1,), order_by=['-nid'])</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> F</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db.models import F</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.update(num=F('num')+1)</span>


    <span style="color: #008000;">#</span><span style="color: #008000;"> Q</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 方式一：</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(nid__gt=10)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(nid=8) | Q(nid__gt=10)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption='root')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 方式二：</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1 = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.connector = 'OR'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 1))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 10))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 9))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2 = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.connector = 'OR'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 1))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 10))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 9))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con.add(q1, 'AND')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con.add(q2, 'AND')</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(con)</span>


    <span style="color: #008000;">#</span><span style="color: #008000;"> 执行原生SQL</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db import connection, connections</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> cursor = connection.cursor()  # cursor = connections['default'].cursor()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> cursor.execute("""SELECT * from auth_user where id = %s""", [1])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> row = cursor.fetchone()</span></pre>
</div>
<span class="cnblogs_code_collapse">其他操作</span></div>
<p>4、连表操作（了不起的双下划线）</p>
<p>利用双下划线和 _set 将表之间的操作连接起来</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('83335a39-e148-4ef2-8f81-75751ad28878')"><img id="code_img_closed_83335a39-e148-4ef2-8f81-75751ad28878" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_83335a39-e148-4ef2-8f81-75751ad28878" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('83335a39-e148-4ef2-8f81-75751ad28878',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_83335a39-e148-4ef2-8f81-75751ad28878" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserProfile(models.Model):
    user_info </span>= models.OneToOneField(<span style="color: #800000;">'</span><span style="color: #800000;">UserInfo</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    username </span>= models.CharField(max_length=64<span style="color: #000000;">)
    password </span>= models.CharField(max_length=64<span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.username


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
    user_type_choice </span>=<span style="color: #000000;"> (
        (0, u</span><span style="color: #800000;">'</span><span style="color: #800000;">普通用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (</span>1, u<span style="color: #800000;">'</span><span style="color: #800000;">高级用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )
    user_type </span>= models.IntegerField(choices=<span style="color: #000000;">user_type_choice)
    name </span>= models.CharField(max_length=32<span style="color: #000000;">)
    email </span>= models.CharField(max_length=32<span style="color: #000000;">)
    address </span>= models.CharField(max_length=128<span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.name


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserGroup(models.Model):

    caption </span>= models.CharField(max_length=64<span style="color: #000000;">)

    user_info </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">UserInfo</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.caption


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Host(models.Model):
    hostname </span>= models.CharField(max_length=64<span style="color: #000000;">)
    ip </span>=<span style="color: #000000;"> models.GenericIPAddressField()
    user_group </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">UserGroup</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> self.hostname</pre>
</div>
<span class="cnblogs_code_collapse">表结构实例</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('039299d9-a607-45b4-b43a-2d80fc298261')"><img id="code_img_closed_039299d9-a607-45b4-b43a-2d80fc298261" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_039299d9-a607-45b4-b43a-2d80fc298261" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('039299d9-a607-45b4-b43a-2d80fc298261',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_039299d9-a607-45b4-b43a-2d80fc298261" class="cnblogs_code_hide">
<pre>user_info_obj = models.UserInfo.objects.filter(id=1<span style="color: #000000;">).first()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.user_type
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.get_user_type_display()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.userprofile.password
 
user_info_obj </span>= models.UserInfo.objects.filter(id=1).values(<span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">userprofile__username</span><span style="color: #800000;">'</span><span style="color: #000000;">).first()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.keys()
</span><span style="color: #0000ff;">print</span> user_info_obj.values()</pre>
</div>
<span class="cnblogs_code_collapse">一对一操作</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('d52c6dd8-a558-46cc-a8e7-3a26aabda1a0')"><img id="code_img_closed_d52c6dd8-a558-46cc-a8e7-3a26aabda1a0" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_d52c6dd8-a558-46cc-a8e7-3a26aabda1a0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d52c6dd8-a558-46cc-a8e7-3a26aabda1a0',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_d52c6dd8-a558-46cc-a8e7-3a26aabda1a0" class="cnblogs_code_hide">
<pre><span style="color: #000000;">类似一对一
</span>1<span style="color: #000000;">、搜索条件使用 __ 连接
</span>2、获取值时使用 .    连接</pre>
</div>
<span class="cnblogs_code_collapse">一对多</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('b7bdfc1c-c579-4617-8075-116807906e00')"><img id="code_img_closed_b7bdfc1c-c579-4617-8075-116807906e00" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_b7bdfc1c-c579-4617-8075-116807906e00" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b7bdfc1c-c579-4617-8075-116807906e00',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_b7bdfc1c-c579-4617-8075-116807906e00" class="cnblogs_code_hide">
<pre>user_info_obj = models.UserInfo.objects.get(name=u<span style="color: #800000;">'</span><span style="color: #800000;">武沛齐</span><span style="color: #800000;">'</span><span style="color: #000000;">)
user_info_objs </span>=<span style="color: #000000;"> models.UserInfo.objects.all()
 
group_obj </span>= models.UserGroup.objects.get(caption=<span style="color: #800000;">'</span><span style="color: #800000;">CEO</span><span style="color: #800000;">'</span><span style="color: #000000;">)
group_objs </span>=<span style="color: #000000;"> models.UserGroup.objects.all()
 
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 添加数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.add(user_info_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.add(*user_info_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 删除数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.remove(user_info_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.remove(*user_info_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 添加数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.add(group_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.add(*group_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 删除数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.remove(group_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.remove(*group_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 获取数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">print group_obj.user_info.all()</span><span style="color: #008000;">
#</span><span style="color: #008000;">print group_obj.user_info.all().filter(id=1)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 获取数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all()</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all().filter(caption='CEO')</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all().filter(caption='DBA')</span></pre>
</div>
<span class="cnblogs_code_collapse">多对多操作</span></div>
<p>扩展：</p>
<p>a、自定义上传</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('352d90b1-39c9-4d6d-89bc-99b9a2d6501a')"><img id="code_img_closed_352d90b1-39c9-4d6d-89bc-99b9a2d6501a" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_352d90b1-39c9-4d6d-89bc-99b9a2d6501a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('352d90b1-39c9-4d6d-89bc-99b9a2d6501a',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_352d90b1-39c9-4d6d-89bc-99b9a2d6501a" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> upload_file(request):
    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        obj </span>= request.FILES.get(<span style="color: #800000;">'</span><span style="color: #800000;">fafafa</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        f </span>= open(obj.name, <span style="color: #800000;">'</span><span style="color: #800000;">wb</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> chunk <span style="color: #0000ff;">in</span><span style="color: #000000;"> obj.chunks():
            f.write(chunk)
        f.close()
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">file.html</span><span style="color: #800000;">'</span>)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b、Form上传文件实例</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('c05a4af8-8664-47de-a990-6b95fbc84bf5')"><img id="code_img_closed_c05a4af8-8664-47de-a990-6b95fbc84bf5" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_c05a4af8-8664-47de-a990-6b95fbc84bf5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c05a4af8-8664-47de-a990-6b95fbc84bf5',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_c05a4af8-8664-47de-a990-6b95fbc84bf5" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> FileForm(forms.Form):
    ExcelFile </span>= forms.FileField()</pre>
</div>
<span class="cnblogs_code_collapse">Form</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('ccd4fe93-7c06-4d34-a7c6-df11972745e5')"><img id="code_img_closed_ccd4fe93-7c06-4d34-a7c6-df11972745e5" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_ccd4fe93-7c06-4d34-a7c6-df11972745e5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ccd4fe93-7c06-4d34-a7c6-df11972745e5',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_ccd4fe93-7c06-4d34-a7c6-df11972745e5" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UploadFile(models.Model):
    userid </span>= models.CharField(max_length = 30<span style="color: #000000;">)
    file </span>= models.FileField(upload_to = <span style="color: #800000;">'</span><span style="color: #800000;">./upload/</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    date </span>= models.DateTimeField(auto_now_add=True)</pre>
</div>
<span class="cnblogs_code_collapse">Model</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('ef774f62-1be3-455b-b4e8-93cad9996526')"><img id="code_img_closed_ef774f62-1be3-455b-b4e8-93cad9996526" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_ef774f62-1be3-455b-b4e8-93cad9996526" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ef774f62-1be3-455b-b4e8-93cad9996526',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_ef774f62-1be3-455b-b4e8-93cad9996526" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> UploadFile(request):
    uf </span>=<span style="color: #000000;"> AssetForm.FileForm(request.POST,request.FILES)
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> uf.is_valid():
            upload </span>=<span style="color: #000000;"> models.UploadFile()
            upload.userid </span>= 1<span style="color: #000000;">
            upload.file </span>= uf.cleaned_data[<span style="color: #800000;">'</span><span style="color: #800000;">ExcelFile</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            upload.save()
            
            </span><span style="color: #0000ff;">print</span> upload.file</pre>
</div>
<span class="cnblogs_code_collapse">View</span></div>
<h3>Form</h3>
<p>django中的Form一般有两种功能：</p>
<ul>
<li>输入html</li>
<li>验证用户输入</li>
</ul>
<div class="cnblogs_code" onclick="cnblogs_code_show('053cf06c-4eb7-4dda-92e6-cd9ae0d4cafd')"><img id="code_img_closed_053cf06c-4eb7-4dda-92e6-cd9ae0d4cafd" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_053cf06c-4eb7-4dda-92e6-cd9ae0d4cafd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('053cf06c-4eb7-4dda-92e6-cd9ae0d4cafd',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_053cf06c-4eb7-4dda-92e6-cd9ae0d4cafd" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> re
</span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms
</span><span style="color: #0000ff;">from</span> django.core.exceptions <span style="color: #0000ff;">import</span><span style="color: #000000;"> ValidationError


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> mobile_validate(value):
    mobile_re </span>= re.compile(r<span style="color: #800000;">'</span><span style="color: #800000;">^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> mobile_re.match(value):
        </span><span style="color: #0000ff;">raise</span> ValidationError(<span style="color: #800000;">'</span><span style="color: #800000;">手机号码格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">)


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> PublishForm(forms.Form):

    user_type_choice </span>=<span style="color: #000000;"> (
        (0, u</span><span style="color: #800000;">'</span><span style="color: #800000;">普通用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (</span>1, u<span style="color: #800000;">'</span><span style="color: #800000;">高级用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )

    user_type </span>= forms.IntegerField(widget=forms.widgets.Select(choices=<span style="color: #000000;">user_type_choice,
                                                                  attrs</span>={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">}))

    title </span>= forms.CharField(max_length=20<span style="color: #000000;">,
                            min_length</span>=5<span style="color: #000000;">,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">min_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最少为5个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">max_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最多为20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题5-20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    memo </span>= forms.CharField(required=<span style="color: #000000;">False,
                           max_length</span>=256<span style="color: #000000;">,
                           widget</span>=forms.widgets.Textarea(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control no-radius</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">详细描述</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">rows</span><span style="color: #800000;">'</span>: 3<span style="color: #000000;">}))

    phone </span>= forms.CharField(validators=<span style="color: #000000;">[mobile_validate, ],
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机号码</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    email </span>= forms.EmailField(required=<span style="color: #000000;">False,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱不能为空</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱</span><span style="color: #800000;">'</span>}))</pre>
</div>
<span class="cnblogs_code_collapse">Form</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('f23acf56-d663-415f-b477-668be615f557')"><img id="code_img_closed_f23acf56-d663-415f-b477-668be615f557" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_f23acf56-d663-415f-b477-668be615f557" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f23acf56-d663-415f-b477-668be615f557',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_f23acf56-d663-415f-b477-668be615f557" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> publish(request):
    ret </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">status</span><span style="color: #800000;">'</span>: False, <span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #800000;">'</span><span style="color: #800000;">error</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #800000;">'</span><span style="color: #800000;">summary</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">}
    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">:
        request_form </span>=<span style="color: #000000;"> PublishForm(request.POST)
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> request_form.is_valid():
            request_dict </span>=<span style="color: #000000;"> request_form.clean()
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;"> request_dict
            ret[</span><span style="color: #800000;">'</span><span style="color: #800000;">status</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> True
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            error_msg </span>=<span style="color: #000000;"> request_form.errors.as_json()
            ret[</span><span style="color: #800000;">'</span><span style="color: #800000;">error</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> json.loads(error_msg)
    </span><span style="color: #0000ff;">return</span> HttpResponse(json.dumps(ret))</pre>
</div>
<span class="cnblogs_code_collapse">View</span></div>
<p>扩展：ModelForm</p>
<p>在使用Model和Form时，都需要对字段进行定义并指定类型，通过ModelForm则可以省去From中字段的定义</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f4ce127e-0d58-487d-aef4-c2f1ac87e762')"><img id="code_img_closed_f4ce127e-0d58-487d-aef4-c2f1ac87e762" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_f4ce127e-0d58-487d-aef4-c2f1ac87e762" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f4ce127e-0d58-487d-aef4-c2f1ac87e762',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_f4ce127e-0d58-487d-aef4-c2f1ac87e762" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> AdminModelForm(forms.ModelForm):
      
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        model </span>=<span style="color: #000000;"> models.Admin
        </span><span style="color: #008000;">#</span><span style="color: #008000;">fields = '__all__'</span>
        fields = (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
          
        widgets </span>=<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span> : forms.PasswordInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>:<span style="color: #800000;">"</span><span style="color: #800000;">alex</span><span style="color: #800000;">"</span><span style="color: #000000;">}),
        }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3>跨站请求伪造</h3>
<p>一、简介</p>
<p>django为用户实现防止跨站请求伪造的功能，通过中间件&nbsp;django.middleware.csrf.CsrfViewMiddleware 来完成。而对于django中设置防跨站请求伪造功能有分为全局和局部。</p>
<p>全局：</p>
<p>　　中间件&nbsp;django.middleware.csrf.CsrfViewMiddleware</p>
<p>局部：</p>
<ul>
<li>@csrf_protect，为当前函数强制设置防跨站请求伪造功能，即便settings中没有设置全局中间件。</li>
<li>@csrf_exempt，取消当前函数防跨站请求伪造功能，即便settings中设置了全局中间件。</li>
</ul>
<p>注：from django.views.decorators.csrf import csrf_exempt,csrf_protect</p>
<p>二、应用</p>
<p>1、普通表单</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">veiw中设置返回值：
　　return render_to_response('Account/Login.html',data,context_instance=RequestContext(request))　　
     或者
     return render(request, 'xxx.html', data)
 
html中设置Token:
　　{% csrf_token %}
</pre>
</div>
<p>2、Ajax</p>
<p>对于传统的form，可以通过表单的方式将token再次发送到服务端，而对于ajax的话，使用如下方式。</p>
<p>view.py</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">from django.template.context import RequestContext
# Create your views here.
 
 
def test(request):
 
    if request.method == 'POST':
        print request.POST
        return HttpResponse('ok')
    return  render_to_response('app01/test.html',context_instance=RequestContext(request))
</pre>
</div>
<p>text.html</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang="en"&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    {% csrf_token %}
 
    &lt;input type="button" onclick="Do();"  value="Do it"/&gt;
 
    &lt;script src="/static/plugin/jquery/jquery-1.8.0.js"&gt;&lt;/script&gt;
    &lt;script src="/static/plugin/jquery/jquery.cookie.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        var csrftoken = $.cookie('csrftoken');
 
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) &amp;&amp; !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        function Do(){
 
            $.ajax({
                url:"/app01/test/",
                data:{id:1},
                type:'POST',
                success:function(data){
                    console.log(data);
                }
            });
 
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<p>更多：https://docs.djangoproject.com/en/dev/ref/csrf/#ajax</p>
<h3>Cookie</h3>
<p>1、获取Cookie：</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">    request.COOKIES['key']
    request.get_signed_cookie(key, default=RAISE_ERROR, salt='', max_age=None)
        参数：
            default: 默认值
               salt: 加密盐
            max_age: 后台控制过期时间
</pre>
</div>
<p>2、设置Cookie：</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">    rep = HttpResponse(...) 或 rep ＝ render(request, ...)

    rep.set_cookie(key,value,...)
    rep.set_signed_cookie(key,value,salt='加密盐',...)
        参数：
            key,              键
            value='',         值
            max_age=None,     超时时间
            expires=None,     超时时间(IE requires expires, so set it if hasn't been already.)
            path='/',         Cookie生效的路径，/ 表示根路径，特殊的：跟路径的cookie可以被任何url的页面访问
            domain=None,      Cookie生效的域名
            secure=False,     https传输
            httponly=False    只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</pre>
</div>
<p>由于cookie保存在客户端的电脑上，所以，JavaScript和jquery也可以操作cookie。</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">&lt;script src='/static/js/jquery.cookie.js'&gt;&lt;/script&gt;
$.cookie("list_pager_num", 30,{ path: '/' });
</pre>
</div>
<h3>Session</h3>
<p>Django中默认支持Session，其内部提供了5种类型的Session供开发者使用：</p>
<ul>
<li>数据库（默认）</li>
<li>缓存</li>
<li>文件</li>
<li>缓存+数据库</li>
<li>加密cookie</li>
</ul>
<p>1、数据库Session</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">Django默认支持Session，并且默认是将Session数据存储在数据库中，即：django_session 表中。

a. 配置 settings.py

    SESSION_ENGINE = 'django.contrib.sessions.backends.db'   # 引擎（默认）
    
    SESSION_COOKIE_NAME ＝ "sessionid"                       # Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）
    SESSION_COOKIE_PATH ＝ "/"                               # Session的cookie保存的路径（默认）
    SESSION_COOKIE_DOMAIN = None                             # Session的cookie保存的域名（默认）
    SESSION_COOKIE_SECURE = False                            # 是否Https传输cookie（默认）
    SESSION_COOKIE_HTTPONLY = True                           # 是否Session的cookie只支持http传输（默认）
    SESSION_COOKIE_AGE = 1209600                             # Session的cookie失效日期（2周）（默认）
    SESSION_EXPIRE_AT_BROWSER_CLOSE = False                  # 是否关闭浏览器使得Session过期（默认）
    SESSION_SAVE_EVERY_REQUEST = False                       # 是否每次请求都保存Session，默认修改之后才保存（默认）



b. 使用

    def index(request):
        # 获取、设置、删除Session中数据
        request.session['k1']
        request.session.get('k1',None)
        request.session['k1'] = 123
        request.session.setdefault('k1',123) # 存在则不设置
        del request.session['k1']

        # 所有 键、值、键值对
        request.session.keys()
        request.session.values()
        request.session.items()
        request.session.iterkeys()
        request.session.itervalues()
        request.session.iteritems()


        # 用户session的随机字符串
        request.session.session_key

        # 将所有Session失效日期小于当前日期的数据删除
        request.session.clear_expired()

        # 检查 用户session的随机字符串 在数据库中是否
        request.session.exists("session_key")

        # 删除当前用户的所有Session数据
        request.session.delete("session_key")

        request.session.set_expiry(value)
            * 如果value是个整数，session会在些秒数后失效。
            * 如果value是个datatime或timedelta，session就会在这个时间后失效。
            * 如果value是0,用户关闭浏览器session就会失效。
            * 如果value是None,session会依赖全局session失效策略。
</pre>
</div>
<p>　　2、缓存Session</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">    a. 配置 settings.py

        SESSION_ENGINE = 'django.contrib.sessions.backends.cache'  # 引擎
        SESSION_CACHE_ALIAS = 'default'                            # 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置


        SESSION_COOKIE_NAME ＝ "sessionid"                        # Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串
        SESSION_COOKIE_PATH ＝ "/"                                # Session的cookie保存的路径
        SESSION_COOKIE_DOMAIN = None                              # Session的cookie保存的域名
        SESSION_COOKIE_SECURE = False                             # 是否Https传输cookie
        SESSION_COOKIE_HTTPONLY = True                            # 是否Session的cookie只支持http传输
        SESSION_COOKIE_AGE = 1209600                              # Session的cookie失效日期（2周）
        SESSION_EXPIRE_AT_BROWSER_CLOSE = False                   # 是否关闭浏览器使得Session过期
        SESSION_SAVE_EVERY_REQUEST = False                        # 是否每次请求都保存Session，默认修改之后才保存



    b. 使用

        同上
</pre>
</div>
<p>3、文件Session</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">    a. 配置 settings.py

        SESSION_ENGINE = 'django.contrib.sessions.backends.file'    # 引擎
        SESSION_FILE_PATH = None                                    # 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()                                                            # 如：/var/folders/d3/j9tj0gz93dg06bmwxmhh6_xm0000gn/T 


        SESSION_COOKIE_NAME ＝ "sessionid"                          # Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串
        SESSION_COOKIE_PATH ＝ "/"                                  # Session的cookie保存的路径
        SESSION_COOKIE_DOMAIN = None                                # Session的cookie保存的域名
        SESSION_COOKIE_SECURE = False                               # 是否Https传输cookie
        SESSION_COOKIE_HTTPONLY = True                              # 是否Session的cookie只支持http传输
        SESSION_COOKIE_AGE = 1209600                                # Session的cookie失效日期（2周）
        SESSION_EXPIRE_AT_BROWSER_CLOSE = False                     # 是否关闭浏览器使得Session过期
        SESSION_SAVE_EVERY_REQUEST = False                          # 是否每次请求都保存Session，默认修改之后才保存

    b. 使用

        同上
</pre>
</div>
<p>4、缓存+数据库Session</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">    数据库用于做持久化，缓存用于提高效率

    a. 配置 settings.py

        SESSION_ENGINE = 'django.contrib.sessions.backends.cached_db'        # 引擎
    
    b. 使用

        同上
</pre>
</div>
<p>5、加密cookie Session</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">    a. 配置 settings.py
        
        SESSION_ENGINE = 'django.contrib.sessions.backends.signed_cookies'   # 引擎

    b. 使用

        同上
</pre>
</div>
<p>更多参考：<a href="https://docs.djangoproject.com/en/1.9/topics/http/sessions/" target="_blank">猛击这里</a> 和 <a href="https://docs.djangoproject.com/en/1.9/ref/settings/#settings-sessions" target="_blank">猛击这里</a></p>
<p>扩展：Session用户验证</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">def login(func):
    def wrap(request, *args, **kwargs):
        # 如果未登陆，跳转到指定页面
        if request.path == '/test/':
            return redirect('http://www.baidu.com')
        return func(request, *args, **kwargs)
    return wrap
</pre>
</div>
<h3>分页</h3>
<p>一、Django内置分页</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('4fa11d8a-4332-42d8-86dc-1a327410034d')"><img id="code_img_closed_4fa11d8a-4332-42d8-86dc-1a327410034d" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_4fa11d8a-4332-42d8-86dc-1a327410034d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4fa11d8a-4332-42d8-86dc-1a327410034d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_4fa11d8a-4332-42d8-86dc-1a327410034d" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render
</span><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator, EmptyPage, PageNotAnInteger

L </span>=<span style="color: #000000;"> []
</span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(999<span style="color: #000000;">):
    L.append(i)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    current_page </span>= request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">p</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    paginator </span>= Paginator(L, 10<span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> per_page: 每页显示条目数量</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> count:    数据总个数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> num_pages:总页数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page_range:总页数的索引范围，如: (1,10),(1,200)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page:     page对象</span>
    <span style="color: #0000ff;">try</span><span style="color: #000000;">:
        posts </span>=<span style="color: #000000;"> paginator.page(current_page)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> has_next              是否有下一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> next_page_number      下一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> has_previous          是否有上一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> previous_page_number  上一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> object_list           分页之后的数据列表</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> number                当前页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> paginator             paginator对象</span>
    <span style="color: #0000ff;">except</span><span style="color: #000000;"> PageNotAnInteger:
        posts </span>= paginator.page(1<span style="color: #000000;">)
    </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> EmptyPage:
        posts </span>=<span style="color: #000000;"> paginator.page(paginator.num_pages)
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">posts</span><span style="color: #800000;">'</span>: posts})</pre>
</div>
<span class="cnblogs_code_collapse">views.py</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('cf01c0ec-8cd7-4197-be8e-dbd066851a1f')"><img id="code_img_closed_cf01c0ec-8cd7-4197-be8e-dbd066851a1f" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_cf01c0ec-8cd7-4197-be8e-dbd066851a1f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('cf01c0ec-8cd7-4197-be8e-dbd066851a1f',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_cf01c0ec-8cd7-4197-be8e-dbd066851a1f" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span> posts %<span style="color: #000000;">}
        </span>&lt;li&gt;{{ item }}&lt;/li&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}
</span>&lt;/ul&gt;

&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">pagination</span><span style="color: #800000;">"</span>&gt;
      &lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">step-links</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
        {</span>% <span style="color: #0000ff;">if</span> posts.has_previous %<span style="color: #000000;">}
            </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.previous_page_number }}</span><span style="color: #800000;">"</span>&gt;Previous&lt;/a&gt;<span style="color: #000000;">
        {</span>% endif %<span style="color: #000000;">}
          </span>&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">current</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
            Page {{ posts.number }} of {{ posts.paginator.num_pages }}.
          </span>&lt;/span&gt;<span style="color: #000000;">
          {</span>% <span style="color: #0000ff;">if</span> posts.has_next %<span style="color: #000000;">}
              </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.next_page_number }}</span><span style="color: #800000;">"</span>&gt;Next&lt;/a&gt;<span style="color: #000000;">
          {</span>% endif %<span style="color: #000000;">}
      </span>&lt;/span&gt;

&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">Html</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('4ee06d7b-d963-499d-b5b6-ddb8015339d2')"><img id="code_img_closed_4ee06d7b-d963-499d-b5b6-ddb8015339d2" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_4ee06d7b-d963-499d-b5b6-ddb8015339d2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4ee06d7b-d963-499d-b5b6-ddb8015339d2',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_4ee06d7b-d963-499d-b5b6-ddb8015339d2" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render
</span><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator, EmptyPage, PageNotAnInteger


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> CustomPaginator(Paginator):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, current_page, max_pager_num, *args, **<span style="color: #000000;">kwargs):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        :param current_page: 当前页
        :param max_pager_num:最多显示的页码个数
        :param args:
        :param kwargs:
        :return:
        </span><span style="color: #800000;">"""</span><span style="color: #000000;">
        self.current_page </span>=<span style="color: #000000;"> int(current_page)
        self.max_pager_num </span>=<span style="color: #000000;"> max_pager_num
        super(CustomPaginator, self).</span><span style="color: #800080;">__init__</span>(*args, **<span style="color: #000000;">kwargs)

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> page_num_range(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 当前页面</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.current_page</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 总页数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.num_pages</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 最多显示的页码个数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.max_pager_num</span>
        <span style="color: #0000ff;">print</span>(1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.num_pages &lt;<span style="color: #000000;"> self.max_pager_num:
            </span><span style="color: #0000ff;">return</span> range(1, self.num_pages + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(2<span style="color: #000000;">)
        part </span>= int(self.max_pager_num / 2<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.current_page - part &lt; 1<span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> range(1, self.max_pager_num + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(3<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.current_page + part &gt;<span style="color: #000000;"> self.num_pages:
            </span><span style="color: #0000ff;">return</span> range(self.num_pages + 1 - self.max_pager_num, self.num_pages + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(4<span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> range(self.current_page - part, self.current_page + part + 1<span style="color: #000000;">)


L </span>=<span style="color: #000000;"> []
</span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(999<span style="color: #000000;">):
    L.append(i)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    current_page </span>= request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">p</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    paginator </span>= CustomPaginator(current_page, 11, L, 10<span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> per_page: 每页显示条目数量</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> count:    数据总个数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> num_pages:总页数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page_range:总页数的索引范围，如: (1,10),(1,200)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page:     page对象</span>
    <span style="color: #0000ff;">try</span><span style="color: #000000;">:
        posts </span>=<span style="color: #000000;"> paginator.page(current_page)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> has_next              是否有下一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> next_page_number      下一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> has_previous          是否有上一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> previous_page_number  上一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> object_list           分页之后的数据列表</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> number                当前页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> paginator             paginator对象</span>
    <span style="color: #0000ff;">except</span><span style="color: #000000;"> PageNotAnInteger:
        posts </span>= paginator.page(1<span style="color: #000000;">)
    </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> EmptyPage:
        posts </span>=<span style="color: #000000;"> paginator.page(paginator.num_pages)

    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">posts</span><span style="color: #800000;">'</span>: posts})</pre>
</div>
<span class="cnblogs_code_collapse">扩展内置分页：views.py</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c5c136e7-05dd-45cb-a84e-d7fc16bf19ba')"><img id="code_img_closed_c5c136e7-05dd-45cb-a84e-d7fc16bf19ba" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_c5c136e7-05dd-45cb-a84e-d7fc16bf19ba" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c5c136e7-05dd-45cb-a84e-d7fc16bf19ba',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_c5c136e7-05dd-45cb-a84e-d7fc16bf19ba" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;ul&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span> posts %<span style="color: #000000;">}
        </span>&lt;li&gt;{{ item }}&lt;/li&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}
</span>&lt;/ul&gt;

&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">pagination</span><span style="color: #800000;">"</span>&gt;
&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">step-links</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
{</span>% <span style="color: #0000ff;">if</span> posts.has_previous %<span style="color: #000000;">}
    </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.previous_page_number }}</span><span style="color: #800000;">"</span>&gt;Previous&lt;/a&gt;<span style="color: #000000;">
{</span>% endif %<span style="color: #000000;">}

    {</span>% <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> posts.paginator.page_num_range %<span style="color: #000000;">}
        </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ i }}</span><span style="color: #800000;">"</span>&gt;{{ i }}&lt;/a&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}

    {</span>% <span style="color: #0000ff;">if</span> posts.has_next %<span style="color: #000000;">}
        </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.next_page_number }}</span><span style="color: #800000;">"</span>&gt;Next&lt;/a&gt;<span style="color: #000000;">
    {</span>% endif %<span style="color: #000000;">}
</span>&lt;/span&gt;

&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">current</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
Page {{ posts.number }} of {{ posts.paginator.num_pages }}.
</span>&lt;/span&gt;

&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">扩展内置分页：Html</span></div>
<p>二、自定义分页</p>
<p>分页功能在每个网站都是必要的，对于分页来说，其实就是根据用户的输入计算出应该在数据库表中的起始位置。</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页...）</p>
<p>3、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>4、在数据表中根据起始位置取值，页面上输出数据</p>
<hr />
<p>需求又来了，需要在页面上显示分页的页面。如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页...）</p>
<p>3、设定显示多少页号</p>
<p>4、获取当前数据总条数</p>
<p>5、根据设定显示多少页号和数据总条数计算出，总页数</p>
<p>6、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>7、在数据表中根据起始位置取值，页面上输出数据</p>
<p>8、输出分页html，如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('590aa33e-98d3-4cca-9d22-0b4f49198e15')"><img id="code_img_closed_590aa33e-98d3-4cca-9d22-0b4f49198e15" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_590aa33e-98d3-4cca-9d22-0b4f49198e15" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('590aa33e-98d3-4cca-9d22-0b4f49198e15',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_590aa33e-98d3-4cca-9d22-0b4f49198e15" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> _*_coding:utf-8_*_</span>
<span style="color: #0000ff;">from</span> django.utils.safestring <span style="color: #0000ff;">import</span><span style="color: #000000;"> mark_safe
 
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> PageInfo(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self,current,totalItem,peritems=5<span style="color: #000000;">):
        self.</span><span style="color: #800080;">__current</span>=<span style="color: #000000;">current
        self.</span><span style="color: #800080;">__peritems</span>=<span style="color: #000000;">peritems
        self.</span><span style="color: #800080;">__totalItem</span>=<span style="color: #000000;">totalItem
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> From(self):
        </span><span style="color: #0000ff;">return</span> (self.<span style="color: #800080;">__current</span>-1)*self.<span style="color: #800080;">__peritems</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> To(self):
        </span><span style="color: #0000ff;">return</span> self.<span style="color: #800080;">__current</span>*self.<span style="color: #800080;">__peritems</span>
    <span style="color: #0000ff;">def</span> TotalPage(self):  <span style="color: #008000;">#</span><span style="color: #008000;">总页数</span>
        result=divmod(self.<span style="color: #800080;">__totalItem</span>,self.<span style="color: #800080;">__peritems</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> result[1]==<span style="color: #000000;">0:
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result[0]
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> result[0]+1
 
<span style="color: #0000ff;">def</span> Custompager(baseurl,currentPage,totalpage):  <span style="color: #008000;">#</span><span style="color: #008000;">基础页，当前页，总页数</span>
    perPager=11
    <span style="color: #008000;">#</span><span style="color: #008000;">总页数&lt;11</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">0 -- totalpage</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">总页数&gt;11</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">当前页大于5 currentPage-5 -- currentPage+5</span>
            <span style="color: #008000;">#</span><span style="color: #008000;">currentPage+5是否超过总页数,超过总页数，end就是总页数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">当前页小于5 0 -- 11</span>
    begin=<span style="color: #000000;">0
    end</span>=<span style="color: #000000;">0
    </span><span style="color: #0000ff;">if</span> totalpage &lt;= 11<span style="color: #000000;">:
        begin</span>=<span style="color: #000000;">0
        end</span>=<span style="color: #000000;">totalpage
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">if</span> currentPage&gt;5<span style="color: #000000;">:
            begin</span>=currentPage-5<span style="color: #000000;">
            end</span>=currentPage+5
            <span style="color: #0000ff;">if</span> end &gt;<span style="color: #000000;"> totalpage:
                end</span>=<span style="color: #000000;">totalpage
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            begin</span>=<span style="color: #000000;">0
            end</span>=11<span style="color: #000000;">
    pager_list</span>=<span style="color: #000000;">[]
    </span><span style="color: #0000ff;">if</span> currentPage&lt;=1<span style="color: #000000;">:
        first</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;首页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        first</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;首页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,1<span style="color: #000000;">)
    pager_list.append(first)
 
    </span><span style="color: #0000ff;">if</span> currentPage&lt;=1<span style="color: #000000;">:
        prev</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;上一页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        prev</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;上一页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,currentPage-1<span style="color: #000000;">)
    pager_list.append(prev)
 
    </span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(begin+1,end+1<span style="color: #000000;">):
        </span><span style="color: #0000ff;">if</span> i ==<span style="color: #000000;"> currentPage:
            temp</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d' class='selected'&gt;%d&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,i,i)
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            temp</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;%d&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,i,i)
        pager_list.append(temp)
    </span><span style="color: #0000ff;">if</span> currentPage&gt;=<span style="color: #000000;">totalpage:
        next</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='#'&gt;下一页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        next</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;下一页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,currentPage+1<span style="color: #000000;">)
    pager_list.append(next)
    </span><span style="color: #0000ff;">if</span> currentPage&gt;=<span style="color: #000000;">totalpage:
        last</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;末页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        last</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;末页&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,totalpage)
    pager_list.append(last)
    result</span>=<span style="color: #800000;">''</span><span style="color: #000000;">.join(pager_list)
    </span><span style="color: #0000ff;">return</span> mark_safe(result)   <span style="color: #008000;">#</span><span style="color: #008000;">把字符串转成html语言</span></pre>
</div>
<span class="cnblogs_code_collapse">分页实例</span></div>
<p>总结，分页时需要做三件事：</p>
<ul>
<li>创建处理分页数据的类</li>
<li>根据分页数据获取数据</li>
<li>输出分页HTML，即：［上一页］［1］［2］［3］［4］［5］［下一页］</li>
</ul>
<h3>缓存</h3>
<p>由于Django是动态网站，所有每次请求均会去数据进行相应的操作，当程序访问量大时，耗时必然会更加明显，最简单解决方式是使用：缓存，缓存将一个某个views的返回值保存至内存或者memcache中，5分钟内再有人来访问时，则不再去执行view中的操作，而是直接从内存或者Redis中之前缓存的内容拿到，并返回。</p>
<p>Django中提供了6种缓存方式：</p>
<ul>
<li>开发调试</li>
<li><span style="line-height: 1.5;">内存</span></li>
<li><span style="line-height: 1.5;">文件</span></li>
<li><span style="line-height: 1.5;">数据库</span></li>
<li><span style="line-height: 1.5;">Memcache缓存（python-memcached模块）</span></li>
<li><span style="line-height: 1.5;">Memcache缓存（pylibmc模块）</span></li>
</ul>
<p><span style="font-size: 18px;"><strong>1、配置</strong></span></p>
<p>a、开发调试</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('d93de2ed-2375-4a81-9537-30de11022a07')"><img id="code_img_closed_d93de2ed-2375-4a81-9537-30de11022a07" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_d93de2ed-2375-4a81-9537-30de11022a07" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d93de2ed-2375-4a81-9537-30de11022a07',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_d93de2ed-2375-4a81-9537-30de11022a07" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 此为开始调试用，实际内部不做任何操作</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.dummy.DummyCache</span><span style="color: #800000;">'</span>,     <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">TIMEOUT</span><span style="color: #800000;">'</span>: 300,                                               <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存超时时间（默认300，None表示永不过期，0表示立即过期）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">OPTIONS</span><span style="color: #800000;">'</span><span style="color: #000000;">:{
                    </span><span style="color: #800000;">'</span><span style="color: #800000;">MAX_ENTRIES</span><span style="color: #800000;">'</span>: 300,                                       <span style="color: #008000;">#</span><span style="color: #008000;"> 最大缓存个数（默认300）</span>
                    <span style="color: #800000;">'</span><span style="color: #800000;">CULL_FREQUENCY</span><span style="color: #800000;">'</span>: 3,                                      <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span>
<span style="color: #000000;">                },
                </span><span style="color: #800000;">'</span><span style="color: #800000;">KEY_PREFIX</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>,                                             <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存key的前缀（默认空）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">VERSION</span><span style="color: #800000;">'</span>: 1,                                                 <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存key的版本（默认1）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">KEY_FUNCTION</span><span style="color: #800000;">'</span> 函数名                                          <span style="color: #008000;">#</span><span style="color: #008000;"> 生成key的函数（默认函数会生成为：【前缀:版本:key】）</span>
<span style="color: #000000;">            }
        }


    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 自定义key</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> default_key_func(key, key_prefix, version):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        Default function to generate keys.

        Constructs the key used by all other methods. By default it prepends
        the `key_prefix'. KEY_FUNCTION can be used to specify an alternate
        function with custom key making behavior.
        </span><span style="color: #800000;">"""</span>
        <span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">%s:%s:%s</span><span style="color: #800000;">'</span> %<span style="color: #000000;"> (key_prefix, version, key)

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> get_key_func(key_func):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        Function to decide which key function to use.

        Defaults to ``default_key_func``.
        </span><span style="color: #800000;">"""</span>
        <span style="color: #0000ff;">if</span> key_func <span style="color: #0000ff;">is</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> None:
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> callable(key_func):
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> key_func
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> import_string(key_func)
        </span><span style="color: #0000ff;">return</span> default_key_func</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b、内存</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('9a170648-aa44-46b0-80e0-b3b043f2be48')"><img id="code_img_closed_9a170648-aa44-46b0-80e0-b3b043f2be48" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_9a170648-aa44-46b0-80e0-b3b043f2be48" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9a170648-aa44-46b0-80e0-b3b043f2be48',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_9a170648-aa44-46b0-80e0-b3b043f2be48" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至内存的变量中</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.locmem.LocMemCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">unique-snowflake</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            }
        }

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：其他配置同开发调试版本</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、文件</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f3c5bf5e-abf7-4f77-ba71-2b15e181747a')"><img id="code_img_closed_f3c5bf5e-abf7-4f77-ba71-2b15e181747a" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_f3c5bf5e-abf7-4f77-ba71-2b15e181747a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f3c5bf5e-abf7-4f77-ba71-2b15e181747a',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_f3c5bf5e-abf7-4f77-ba71-2b15e181747a" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至文件</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
<span style="color: #000000;">
        CACHES </span>=<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.filebased.FileBasedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">/var/tmp/django_cache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            }
        }
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：其他配置同开发调试版本</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>d、数据库</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('77d4854a-4b2a-465b-a23b-3f78c17a937d')"><img id="code_img_closed_77d4854a-4b2a-465b-a23b-3f78c17a937d" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_77d4854a-4b2a-465b-a23b-3f78c17a937d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('77d4854a-4b2a-465b-a23b-3f78c17a937d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_77d4854a-4b2a-465b-a23b-3f78c17a937d" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至数据库</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.db.DatabaseCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">my_cache_table</span><span style="color: #800000;">'</span>, <span style="color: #008000;">#</span><span style="color: #008000;"> 数据库表</span>
<span style="color: #000000;">            }
        }

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：执行创建表命令 python manage.py createcachetable</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>e、Memcache缓存（python-memcached模块）</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('765336c4-14ab-42f2-acad-8cf9f48c61bf')"><img id="code_img_closed_765336c4-14ab-42f2-acad-8cf9f48c61bf" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_765336c4-14ab-42f2-acad-8cf9f48c61bf" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('765336c4-14ab-42f2-acad-8cf9f48c61bf',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_765336c4-14ab-42f2-acad-8cf9f48c61bf" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存使用python-memcached模块连接memcache</span>
<span style="color: #000000;">
    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">unix:/tmp/memcached.sock</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }   

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span><span style="color: #000000;">: [
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.240:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.242:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            ]
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>f、Memcache缓存（pylibmc模块）</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('bea5e300-c1bb-4b26-82ab-774cace213e7')"><img id="code_img_closed_bea5e300-c1bb-4b26-82ab-774cace213e7" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_bea5e300-c1bb-4b26-82ab-774cace213e7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bea5e300-c1bb-4b26-82ab-774cace213e7',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_bea5e300-c1bb-4b26-82ab-774cace213e7" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存使用pylibmc模块连接memcache</span>
<span style="color: #000000;">    
    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">/tmp/memcached.sock</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }   

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span><span style="color: #000000;">: [
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.240:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.242:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            ]
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong><span style="font-size: 18px;">2、应用</span></strong></p>
<p>a. 全站使用</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('71b0d09b-0f4c-41bc-a3a2-c78ec36e920e')"><img id="code_img_closed_71b0d09b-0f4c-41bc-a3a2-c78ec36e920e" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_71b0d09b-0f4c-41bc-a3a2-c78ec36e920e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('71b0d09b-0f4c-41bc-a3a2-c78ec36e920e',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_71b0d09b-0f4c-41bc-a3a2-c78ec36e920e" class="cnblogs_code_hide">
<pre><span style="color: #000000;">   使用中间件，经过一系列的认证等操作，如果内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户，当返回给用户之前，判断缓存中是否已经存在，如果不存在则UpdateCacheMiddleware会将缓存保存至缓存，从而实现全站缓存

    MIDDLEWARE </span>=<span style="color: #000000;"> [
        </span><span style="color: #800000;">'</span><span style="color: #800000;">django.middleware.cache.UpdateCacheMiddleware</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 其他中间件...</span>
        <span style="color: #800000;">'</span><span style="color: #800000;">django.middleware.cache.FetchFromCacheMiddleware</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    ]

    CACHE_MIDDLEWARE_ALIAS </span>= <span style="color: #800000;">""</span><span style="color: #000000;">
    CACHE_MIDDLEWARE_SECONDS </span>= <span style="color: #800000;">""</span><span style="color: #000000;">
    CACHE_MIDDLEWARE_KEY_PREFIX </span>= <span style="color: #800000;">""</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b.&nbsp;单独视图缓存</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('d2526010-0abb-4d00-b473-c873c7183e03')"><img id="code_img_closed_d2526010-0abb-4d00-b473-c873c7183e03" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_d2526010-0abb-4d00-b473-c873c7183e03" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d2526010-0abb-4d00-b473-c873c7183e03',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_d2526010-0abb-4d00-b473-c873c7183e03" class="cnblogs_code_hide">
<pre><span style="color: #000000;">    方式一：
        </span><span style="color: #0000ff;">from</span> django.views.decorators.cache <span style="color: #0000ff;">import</span><span style="color: #000000;"> cache_page

        @cache_page(</span>60 * 15<span style="color: #000000;">)
        </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_view(request):
            ...

    方式二：
        </span><span style="color: #0000ff;">from</span> django.views.decorators.cache <span style="color: #0000ff;">import</span><span style="color: #000000;"> cache_page

        urlpatterns </span>=<span style="color: #000000;"> [
            url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^foo/([0-9]{1,2})/$</span><span style="color: #800000;">'</span>, cache_page(60 * 15<span style="color: #000000;">)(my_view)),
        ]</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、局部视图使用</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('1580381c-7c4e-40c2-9196-f6aeeb05039d')"><img id="code_img_closed_1580381c-7c4e-40c2-9196-f6aeeb05039d" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_1580381c-7c4e-40c2-9196-f6aeeb05039d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1580381c-7c4e-40c2-9196-f6aeeb05039d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_1580381c-7c4e-40c2-9196-f6aeeb05039d" class="cnblogs_code_hide">
<pre><span style="color: #000000;">    a. 引入TemplateTag

        {</span>% load cache %<span style="color: #000000;">}

    b. 使用缓存

        {</span>% cache 5000 缓存key %<span style="color: #000000;">}
            缓存内容
        {</span>% endcache %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>更多：<a href="https://docs.djangoproject.com/en/1.9/topics/cache/" target="_blank">猛击这里</a></p>
<h3>序列化</h3>
<p>关于Django中的序列化主要应用在将数据库中检索的数据返回给客户端用户，特别的Ajax请求一般返回的为Json格式。</p>
<p>1、serializers</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from django.core import serializers

ret = models.BookType.objects.all()

data = serializers.serialize("json", ret)
</pre>
</div>
<p>2、json.dumps</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">    import json

    #ret = models.BookType.objects.all().values('caption')
    ret = models.BookType.objects.all().values_list('caption')

    ret=list(ret)

    result = json.dumps(ret)
</pre>
</div>
<p>由于json.dumps时无法处理datetime日期，所以可以通过自定义处理器来做扩展，如：</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">import json  
from datetime import date  
from datetime import datetime  
  
class JsonCustomEncoder(json.JSONEncoder):  
   
    def default(self, field):  
    
        if isinstance(field, datetime):  
            return o.strftime('%Y-%m-%d %H:%M:%S')  
        elif isinstance(field, date):  
            return o.strftime('%Y-%m-%d')  
        else:  
            return json.JSONEncoder.default(self, field)  
  
  
# ds = json.dumps(d, cls=JsonCustomEncoder)  
</pre>
</div>
<h3>信号</h3>
<p>Django中提供了&ldquo;信号调度&rdquo;，用于在框架执行操作时解耦。通俗来讲，就是一些动作发生的时候，信号允许特定的发送者去提醒一些接受者。</p>
<p><strong><span style="font-size: 18px;">1、Django内置信号</span></strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">    Model signals
        pre_init                    # django的modal执行其构造方法前，自动触发
        post_init                   # django的modal执行其构造方法后，自动触发
        pre_save                    # django的modal对象保存前，自动触发
        post_save                   # django的modal对象保存后，自动触发
        pre_delete                  # django的modal对象删除前，自动触发
        post_delete                 # django的modal对象删除后，自动触发
        m2m_changed                 # django的modal中使用m2m字段操作第三张表（add,remove,clear）前后，自动触发
        class_prepared              # 程序启动时，检测已注册的app中modal类，对于每一个类，自动触发
    Management signals
        pre_migrate                 # 执行migrate命令前，自动触发
        post_migrate                # 执行migrate命令后，自动触发
    Request/response signals
        request_started             # 请求到来前，自动触发
        request_finished            # 请求结束后，自动触发
        got_request_exception       # 请求异常后，自动触发
    Test signals
        setting_changed             # 使用test测试修改配置文件时，自动触发
        template_rendered           # 使用test测试渲染模板时，自动触发
    Database Wrappers
        connection_created          # 创建数据库连接时，自动触发
</pre>
</div>
<p>对于Django内置的信号，仅需注册指定信号，当程序执行相应操作时，自动触发注册函数：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('e2eabb19-1aa7-4592-aaa5-2d9d6e887697')"><img id="code_img_closed_e2eabb19-1aa7-4592-aaa5-2d9d6e887697" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_e2eabb19-1aa7-4592-aaa5-2d9d6e887697" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e2eabb19-1aa7-4592-aaa5-2d9d6e887697',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_e2eabb19-1aa7-4592-aaa5-2d9d6e887697" class="cnblogs_code_hide">
<pre>    <span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> request_finished
    </span><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> request_started
    </span><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> got_request_exception

    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> class_prepared
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_init, post_init
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_save, post_save
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_delete, post_delete
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> m2m_changed
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_migrate, post_migrate

    </span><span style="color: #0000ff;">from</span> django.test.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> setting_changed
    </span><span style="color: #0000ff;">from</span> django.test.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> template_rendered

    </span><span style="color: #0000ff;">from</span> django.db.backends.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> connection_created


    </span><span style="color: #0000ff;">def</span> callback(sender, **<span style="color: #000000;">kwargs):
        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">xxoo_callback</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(sender,kwargs)

    xxoo.connect(callback)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> xxoo指上述导入的内容</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('f138a07e-bd05-4835-9e42-1ca4cdebb711')"><img id="code_img_closed_f138a07e-bd05-4835-9e42-1ca4cdebb711" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_f138a07e-bd05-4835-9e42-1ca4cdebb711" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f138a07e-bd05-4835-9e42-1ca4cdebb711',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_f138a07e-bd05-4835-9e42-1ca4cdebb711" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> request_finished
</span><span style="color: #0000ff;">from</span> django.dispatch <span style="color: #0000ff;">import</span><span style="color: #000000;"> receiver

@receiver(request_finished)
</span><span style="color: #0000ff;">def</span> my_callback(sender, **<span style="color: #000000;">kwargs):
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">Request finished!</span><span style="color: #800000;">"</span>)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong><span style="font-size: 18px;">2、自定义信号</span></strong></p>
<p>a. 定义信号</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">            import django.dispatch
            pizza_done = django.dispatch.Signal(providing_args=["toppings", "size"])</pre>
</div>
<p>b. 注册信号</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">        def callback(sender, **kwargs):
            print("callback")
            print(sender,kwargs)

        pizza_done.connect(callback)
</pre>
</div>
<p>c. 触发信号</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">        from 路径 import pizza_done

        pizza_done.send(sender='seven',toppings=123, size=456)
</pre>
</div>
<p>由于内置信号的触发者已经集成到Django中，所以其会自动调用，而对于自定义信号则需要开发者在任意位置触发。</p>
<p>更多：<a href="https://docs.djangoproject.com/en/dev/topics/signals/" target="_blank">猛击这里</a></p>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2016-03-06 06:12</span> <a href='http://www.cnblogs.com/wupeiqi/'>武沛齐</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>) &nbsp;<a href="https://i.cnblogs.com/EditArticles.aspx?postid=5246483" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(5246483);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=133379,cb_entryId=5246483,cb_blogApp=currentBlogApp,cb_blogUserGuid='7208b24d-95c9-e111-aa3f-842b2b196315',cb_entryCreatedDate='2016/3/6 6:12:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='#' onclick='return RefreshPage();'>刷新页面</a><a href='#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='cnblogs_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<div id='cnblogs_c2' class='c_ad_block'></div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2017 武沛齐
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
</body>
</html>
